<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Riwayat Pesanan</title>

<style>
body{margin:0;font-family:Arial;background:#f7f7f7}
header{background:#ff8fab;color:#fff;padding:15px;text-align:center;font-size:20px;font-weight:bold}
.container{padding:15px;max-width:1100px;margin:auto}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
button{width:100%;padding:10px;border-radius:8px;border:none;background:#ff8fab;color:#fff;font-weight:bold;cursor:pointer}
button.danger{background:#e74c3c;margin-top:6px}
</style>
</head>

<body>

<header>ðŸ“œ Riwayat Pesanan</header>

<div class="container">
<button onclick="location.href='index.html'">â¬… Kembali</button>
<div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, collection, getDocs, deleteDoc, doc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyCkzEGvVEv-jF-Qg9qGemIAgRSeqQdcThc",
  authDomain:"pesanankue.firebaseapp.com",
  projectId:"pesanankue"
});
const db = getFirestore(app);
const colRef = collection(db,"riwayat_pesanan");

async function loadData(){
  const list = document.getElementById("list");
  list.innerHTML="";
  const snap = await getDocs(colRef);
  snap.forEach(d=>{
    const t = d.data();
    list.innerHTML+=`
    <div class="card">
      <b>${t.nama}</b><br>
      Antar: ${t.tanggalAntar}<br>
      DP: ${t.statusDP}<br>
      Bayar: ${t.metodeBayar} ${t.tanggalBayar||""}<br>
      ${t.items.map(i=>`â€¢ ${i.jenis} ${i.ukuran} (${i.jumlah})`).join("<br>")}
      <button class="danger" onclick="hapus('${d.id}')">ðŸ—‘ Hapus Pesanan</button>
    </div>`;
  });
}
loadData();

window.hapus = async (id) => {
  if(!confirm("Hapus pesanan ini dari riwayat?")) return;
  await deleteDoc(doc(db,"riwayat_pesanan",id));
  loadData();
};
</script>

</body>
</html>
